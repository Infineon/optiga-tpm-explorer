<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>AWS IoT Embedded C Device SDK: Auto Reconnect</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS IoT Embedded C Device SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Auto Reconnect </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Any time the SDK detects that the network is disconnected, this feature will attempt to reconnect as part of the next yield call. On top of reconnecting the MQTT connection, all the topics will be re-subscribed. Auto Reconnect feature can be enabled or disabled using the <a class="el" href="aws__iot__mqtt__interface_8h.html#a720c5cc9b36b437a9ef187a2c839d3e1" title="Enable or Disable AutoReconnect on Network Disconnect. ">aws_iot_mqtt_autoreconnect_set_status()</a> API. The auto-reconnect feature could be enabled at any point of time after <a class="el" href="aws__iot__mqtt__interface_8h.html#ad4dd895d98e1817f50ddff9c4d90a910" title="MQTT Connection Function. ">aws_iot_mqtt_connect()</a>. It should not be enabled before <a class="el" href="aws__iot__mqtt__interface_8h.html#ad4dd895d98e1817f50ddff9c4d90a910" title="MQTT Connection Function. ">aws_iot_mqtt_connect()</a>. You could verify if the auto-reconnect feature is enabled or disabled using the <a class="el" href="aws__iot__mqtt__interface_8h.html#ab448543c3b037c4b8b5b55edda64e076" title="Is the MQTT client set to reconnect automatically? ">aws_iot_is_autoreconnect_enabled()</a> API.</p>
<p>Exponential back-off is used to decide the time between 2 reconnect attempts. There are 2 configuration parameters associated with exponential back-off, <a class="el" href="aws__iot__config_8h.html#aaa07e5dac3597eb87d5a77e3862ccc9f" title="Minimum time before the First reconnect attempt is made as part of the exponential back-off algorithm...">AWS_IOT_MQTT_MIN_RECONNECT_WAIT_INTERVAL</a></p>
<p><a class="el" href="aws__iot__config_8h.html#aafde9ca9e0afeea34f4767aa27041268" title="Maximum time interval after which exponential back-off will stop attempting to reconnect. ">AWS_IOT_MQTT_MAX_RECONNECT_WAIT_INTERVAL</a></p>
<p>After all reconnect attempt failure based on the maximum back-off time, <a class="el" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921ae1894055344ab0aa99a262add704e24e">NETWORK_RECONNECT_TIMED_OUT</a> is returned by <a class="el" href="aws__iot__mqtt__interface_8h.html#aee7520d1eb7c96ac7e560044bbfb98dd" title="Yield to the MQTT client. ">aws_iot_mqtt_yield()</a>. There will be no more reconnect attempts. If a reconnect is needed after this based on some external conditions then use <a class="el" href="aws__iot__mqtt__interface_8h.html#a669140cfbd9de7ad1cf6c3a4f80df1c7" title="MQTT Manual Re-Connection Function. ">aws_iot_mqtt_attempt_reconnect()</a> API to reconnect and re-subscribe. This API could be manually used without turning on the auto-reconnect feature. It will attempt to reconnect only once. <a class="el" href="aws__iot__mqtt__interface_8h.html#a669140cfbd9de7ad1cf6c3a4f80df1c7" title="MQTT Manual Re-Connection Function. ">aws_iot_mqtt_attempt_reconnect()</a> is a blocking call.</p>
<p>In the following cases a network disconnect is detected.</p><ol type="1">
<li>As part of MQTT Keepalive functionality, if we dont get back the Ping Response, then we flag a disconnect and call the <a class="el" href="aws__iot__mqtt__interface_8h.html#a65903a382ec338c4695b4d89c8f73345" title="Disconnect Callback Handler Type. ">iot_disconnect_handler()</a></li>
<li>If we are not able to send the Ping in the first place then it is flagged as a disconnect.</li>
</ol>
<p>The <a class="el" href="aws__iot__mqtt__interface_8h.html#a65903a382ec338c4695b4d89c8f73345" title="Disconnect Callback Handler Type. ">iot_disconnect_handler()</a> is invoked even if the auto-reconnect feature is enabled. It is invoked only once before the beginning of the reconnect attempt. Any time a disconnect is detected because of the keep alive logic then this disconnect handler is invoked.</p>
<p>To optimize the auto-reconnect attempt a new API is introduced to check if the Physical <a class="el" href="structNetwork.html" title="Network Structure. ">Network</a> is up - <a class="el" href="network__interface_8h.html#ac6998fdbecdf368e3dee11e9858edb87" title="Check if TLS layer is still connected. ">iot_tls_is_connected()</a>. Every time before performing a TLS handshake the return value of this function will be checked. This could be underlying Cellular connection or Wifi Connection.</p>
<p>Yield return values could be one of these while using the reconnect feature</p>
<p><a class="el" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921a52cfe3eb10c249a4a698da8f45d640de">RECONNECT_SUCCESSFUL</a></p>
<p><a class="el" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921a4e6861260ac3ff251be638d8f7e63625">NETWORK_ATTEMPTING_RECONNECT</a></p>
<p><a class="el" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921ae1894055344ab0aa99a262add704e24e">NETWORK_RECONNECT_TIMED_OUT</a></p>
<p><a class="el" href="aws__iot__error_8h.html#a329da5c3a42979b72561e28e749f6921aa6b528626e4460829069fc4e7d198c7c">NETWORK_DISCONNECTED</a></p>
<h1><a class="anchor" id="issuesAutoReconnect"></a>
Known Issues</h1>
<ul>
<li>A call to yield while in the auto reconnect algorithm may result in a reconnection attempt. These attempts will involve a new TLS handshake which could take longer than the typical yield timeout. For example, if the yield timeout is 100ms, and the call to yield results in a TLS handshake which completed in 600ms, then in this instance the yield call will return in 600ms. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
